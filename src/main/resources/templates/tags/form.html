<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head}">
    <title>New Tag - Zappa</title>
</head>
<body>
    <nav th:replace="~{fragments/layout :: navbar}"></nav>

    <div th:replace="~{fragments/layout :: alerts}"></div>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">
                            <i class="fas fa-plus me-2"></i>Create New Tag
                        </h4>
                    </div>
                    <div class="card-body">
                        <form th:action="@{/tags}" method="post" th:object="${tag}">
                            <div class="mb-3">
                                <label for="name" class="form-label">Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" th:field="*{name}"
                                       placeholder="Enter tag name" required>
                                <div class="form-text">
                                    Tag names should be lowercase, descriptive, and use hyphens for multiple words (e.g., "spring-boot").
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="color" class="form-label">Color</label>
                                <div class="input-group">
                                    <input type="color" class="form-control form-control-color" id="color" th:field="*{color}"
                                           title="Choose tag color">
                                    <input type="text" class="form-control" id="colorText"
                                           placeholder="#FF5733" pattern="^#[0-9A-Fa-f]{6}$"
                                           th:value="${tag.color}">
                                </div>
                                <div class="form-text">
                                    Choose a color to help visually organize your tags.
                                </div>
                            </div>

                            <!-- Color presets -->
                            <div class="mb-3">
                                <label class="form-label">Popular Colors</label>
                                <div class="d-flex flex-wrap gap-2">
                                    <button type="button" class="btn btn-sm color-preset"
                                            style="background-color: #dc3545; color: white; width: 40px; height: 40px;"
                                            onclick="setColor('#dc3545')" title="Red">
                                    </button>
                                    <button type="button" class="btn btn-sm color-preset"
                                            style="background-color: #198754; color: white; width: 40px; height: 40px;"
                                            onclick="setColor('#198754')" title="Green">
                                    </button>
                                    <button type="button" class="btn btn-sm color-preset"
                                            style="background-color: #0d6efd; color: white; width: 40px; height: 40px;"
                                            onclick="setColor('#0d6efd')" title="Blue">
                                    </button>
                                    <button type="button" class="btn btn-sm color-preset"
                                            style="background-color: #ffc107; color: black; width: 40px; height: 40px;"
                                            onclick="setColor('#ffc107')" title="Yellow">
                                    </button>
                                    <button type="button" class="btn btn-sm color-preset"
                                            style="background-color: #fd7e14; color: white; width: 40px; height: 40px;"
                                            onclick="setColor('#fd7e14')" title="Orange">
                                    </button>
                                    <button type="button" class="btn btn-sm color-preset"
                                            style="background-color: #6f42c1; color: white; width: 40px; height: 40px;"
                                            onclick="setColor('#6f42c1')" title="Purple">
                                    </button>
                                    <button type="button" class="btn btn-sm color-preset"
                                            style="background-color: #20c997; color: white; width: 40px; height: 40px;"
                                            onclick="setColor('#20c997')" title="Teal">
                                    </button>
                                    <button type="button" class="btn btn-sm color-preset"
                                            style="background-color: #e91e63; color: white; width: 40px; height: 40px;"
                                            onclick="setColor('#e91e63')" title="Pink">
                                    </button>
                                </div>
                            </div>

                            <!-- Preview -->
                            <div class="mb-3">
                                <label class="form-label">Preview</label>
                                <div>
                                    <span id="tagPreview" class="badge bg-secondary">
                                        <span th:text="${tag.name} ?: 'tag-name'">tag-name</span>
                                    </span>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between">
                                <a th:href="@{/tags}" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left me-1"></i>Back to Tags
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i>Create Tag
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Tag suggestions -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h6 class="mb-0">Common Tag Suggestions</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="small text-muted">Technology</h6>
                                <span class="badge bg-light text-dark me-1 mb-1 tag-suggestion"
                                      onclick="fillTag('java')" style="cursor: pointer;">java</span>
                                <span class="badge bg-light text-dark me-1 mb-1 tag-suggestion"
                                      onclick="fillTag('spring-boot')" style="cursor: pointer;">spring-boot</span>
                                <span class="badge bg-light text-dark me-1 mb-1 tag-suggestion"
                                      onclick="fillTag('kafka')" style="cursor: pointer;">kafka</span>
                                <span class="badge bg-light text-dark me-1 mb-1 tag-suggestion"
                                      onclick="fillTag('postgresql')" style="cursor: pointer;">postgresql</span>
                                <span class="badge bg-light text-dark me-1 mb-1 tag-suggestion"
                                      onclick="fillTag('docker')" style="cursor: pointer;">docker</span>
                            </div>
                            <div class="col-md-6">
                                <h6 class="small text-muted">Categories</h6>
                                <span class="badge bg-light text-dark me-1 mb-1 tag-suggestion"
                                      onclick="fillTag('todo')" style="cursor: pointer;">todo</span>
                                <span class="badge bg-light text-dark me-1 mb-1 tag-suggestion"
                                      onclick="fillTag('important')" style="cursor: pointer;">important</span>
                                <span class="badge bg-light text-dark me-1 mb-1 tag-suggestion"
                                      onclick="fillTag('reference')" style="cursor: pointer;">reference</span>
                                <span class="badge bg-light text-dark me-1 mb-1 tag-suggestion"
                                      onclick="fillTag('archived')" style="cursor: pointer;">archived</span>
                                <span class="badge bg-light text-dark me-1 mb-1 tag-suggestion"
                                      onclick="fillTag('meeting-notes')" style="cursor: pointer;">meeting-notes</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer th:replace="~{fragments/layout :: footer}"></footer>

    <div th:replace="~{fragments/layout :: scripts}"></div>

    <script>
        function setColor(colorValue) {
            document.getElementById('color').value = colorValue;
            document.getElementById('colorText').value = colorValue;
            updatePreview();
        }

        function fillTag(tagName) {
            document.getElementById('name').value = tagName;
            updatePreview();
        }

        function updatePreview() {
            const name = document.getElementById('name').value || 'tag-name';
            const color = document.getElementById('color').value || '#6c757d';
            const preview = document.getElementById('tagPreview');

            preview.textContent = name;
            preview.style.backgroundColor = color;
            preview.style.color = getContrastColor(color);
        }

        function getContrastColor(hexColor) {
            // Convert hex to RGB
            const r = parseInt(hexColor.slice(1, 3), 16);
            const g = parseInt(hexColor.slice(3, 5), 16);
            const b = parseInt(hexColor.slice(5, 7), 16);

            // Calculate brightness
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;

            return brightness > 128 ? '#000000' : '#ffffff';
        }

        // Set up event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('name');
            const colorInput = document.getElementById('color');
            const colorTextInput = document.getElementById('colorText');

            nameInput.addEventListener('input', updatePreview);
            colorInput.addEventListener('input', function() {
                colorTextInput.value = this.value;
                updatePreview();
            });
            colorTextInput.addEventListener('input', function() {
                if (this.value.match(/^#[0-9A-Fa-f]{6}$/)) {
                    colorInput.value = this.value;
                    updatePreview();
                }
            });

            // Initial preview update
            updatePreview();
        });
    </script>
</body>
</html>